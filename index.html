<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pega Constellation Quiz</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    .question { margin-bottom: 15px; font-weight: bold; }
    .option { margin: 5px 0; display: block; }
    .feedback { margin-top: 10px; font-weight: bold; }
    .correct { color: green; }
    .incorrect { color: red; }
    button { margin-top: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Pega Constellation Quiz</h1>
  <div id="quiz">Loading questions...</div>

  <script>
    let allCategories = [];
    let currentCategoryIndex = 0;
    let currentQuestionIndex = 0;
    let currentQuestions = [];

    fetch('questions.xml')
      .then(response => response.text())
      .then(xmlText => {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
        const categories = xmlDoc.getElementsByTagName('category');
        allCategories = Array.from(categories).map(cat => {
          const name = cat.getAttribute('name');
          const questions = Array.from(cat.getElementsByTagName('question')).map(q => {
            const text = q.getElementsByTagName('text')[0].textContent;
            const options = Array.from(q.getElementsByTagName('option')).map(opt => ({
              id: opt.getAttribute('id'),
              text: opt.textContent
            }));
            const correct = q.getElementsByTagName('correct')[0].textContent.trim();
            return { text, options, correct, category: name };
          });
          return { name, questions };
        });
        startCategory();
      })
      .catch(error => {
        document.getElementById('quiz').innerHTML = '<p>Error loading questions.</p>';
        console.error(error);
      });

    function startCategory() {
      if (currentCategoryIndex >= allCategories.length) {
        document.getElementById('quiz').innerHTML = '<h2>🎉 All categories completed! 🎉</h2>';
        return;
      }
      const category = allCategories[currentCategoryIndex];
      currentQuestions = shuffleArray(category.questions).slice(0, 10);
      currentQuestionIndex = 0;
      showQuestion();
    }

    function showQuestion() {
      const q = currentQuestions[currentQuestionIndex];
      let html = `<h2>Category: ${q.category}</h2>`;
      html += `<div class="question">Q${currentQuestionIndex + 1}: ${q.text}</div>`;
      q.options.forEach(opt => {
        html += `<label class="option"><input type="radio" name="option" value="${opt.id}"> ${opt.id} ${opt.text}</label>`;
      });
      html += '<button onclick="checkAnswer()">Submit</button><div id="feedback" class="feedback"></div>';
      document.getElementById('quiz').innerHTML = html;
    }

    function checkAnswer() {
      const q = currentQuestions[currentQuestionIndex];
      const selected = document.querySelector('input[name="option"]:checked');
      const feedback = document.getElementById('feedback');
      if (!selected) {
        feedback.textContent = 'Please select an option.';
        feedback.className = 'feedback';
        return;
      }
      if (selected.value === q.correct) {
        feedback.textContent = '✅ Correct!';
        feedback.className = 'feedback correct';
        setTimeout(() => {
          currentQuestionIndex++;
          if (currentQuestionIndex < currentQuestions.length) {
            showQuestion();
          } else {
            currentCategoryIndex++;
            startCategory();
          }
        }, 1000);
      } else {
        feedback.textContent = `❌ Incorrect. You must answer all questions in this category correctly to proceed.`;
        feedback.className = 'feedback incorrect';
        setTimeout(() => {
          startCategory();
        }, 2000);
      }
    }

    function shuffleArray(array) {
      const shuffled = array.slice();
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }
  </script>
</body>
</html>
