<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pega Constellation Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      margin: 0;
      padding: 0;
    }
    header {
      padding: 1rem;
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
    }
    .category {
      margin: 2rem;
      padding: 1.5rem;
      border-radius: 8px;
    }
    .category h2 {
      display: flex;
      align-items: center;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    .category-icon {
      margin-right: 0.5rem;
      width: 24px;
      height: 24px;
    }
    .question {
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #ddd;
    }
    .question-text {
      font-weight: bold;
    }
    .options label {
      display: block;
      margin: 0.5rem 0;
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      cursor: pointer;
    }
    .correct {
      background-color: #d4edda;
    }
    .incorrect {
      background-color: #f8d7da;
    }
    .explanation {
      margin-top: 0.5rem;
      padding: 0.5rem;
      border-radius: 4px;
    }
    .submit-btn, .reset-btn {
      margin: 1rem 0.5rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    .submit-btn {
      background-color: #007bff;
      color: white;
    }
    .reset-btn {
      background-color: #dc3545;
      color: white;
    }
    .completed {
      opacity: 0.6;
      pointer-events: none;
    }
    .top-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background-color: #fff;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .top-bar button {
      margin: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>Pega Constellation Quiz</header>
  <div class="top-bar" id="categoryButtons"></div>
  <div id="quizContainer"></div>

  <script>
    const colors = ['#d1ecf1', '#d4edda', '#fff3cd', '#f8d7da', '#e2e3e5', '#f0d7f8'];
    let questionsByCategory = {};
    let completedCategories = {};

    fetch('questions.xml')
      .then(response => response.text())
      .then(data => (new window.DOMParser()).parseFromString(data, 'text/xml'))
      .then(xml => {
        const categories = Array.from(xml.getElementsByTagName('category'));
        const container = document.getElementById('quizContainer');
        const buttonBar = document.getElementById('categoryButtons');

        categories.forEach((categoryEl, index) => {
          const categoryName = categoryEl.getAttribute('name') === 'App Studio & Declarative Development' ? 'Low Code Development' : categoryEl.getAttribute('name');
          const color = colors[index % colors.length];

          const questions = Array.from(categoryEl.getElementsByTagName('question')).map(q => {
            const text = q.getElementsByTagName('text')[0].textContent;
            const correct = q.getElementsByTagName('correct')[0].textContent;
            const options = Array.from(q.getElementsByTagName('option')).map(opt => ({
              id: opt.getAttribute('id'),
              text: opt.childNodes[0].nodeValue,
              explanation: opt.getElementsByTagName('explanation')[0]?.textContent || ''
            }));
            return { text, correct, options };
          });

          questionsByCategory[categoryName] = questions;
          const selectedQuestions = shuffle(questions).slice(0, 10);
          renderCategory(categoryName, selectedQuestions, color);

          const catBtn = document.createElement('button');
          catBtn.textContent = categoryName;
          catBtn.style.backgroundColor = color;
          catBtn.onclick = () => {
            document.getElementById(`cat-${categoryName}`).scrollIntoView({ behavior: 'smooth' });
          };
          buttonBar.appendChild(catBtn);
        });
      });

    function renderCategory(name, questions, color) {
      const catDiv = document.createElement('div');
      catDiv.className = 'category';
      catDiv.id = `cat-${name}`;
      catDiv.style.backgroundColor = color;

      const header = document.createElement('h2');
      header.textContent = name;
      catDiv.appendChild(header);

      const submitTop = createSubmitControls(name);
      catDiv.appendChild(submitTop);

      questions.forEach((q, i) => {
        const qDiv = document.createElement('div');
        qDiv.className = 'question';
        qDiv.innerHTML = `<div class="question-text">${q.text}</div>`;

        const optDiv = document.createElement('div');
        optDiv.className = 'options';

        q.options.forEach(opt => {
          const id = `${name}-q${i}-${opt.id}`;
          const label = document.createElement('label');
          label.innerHTML = `<input type="radio" name="${name}-q${i}" value="${opt.id}"> ${opt.text}`;
          label.dataset.explanation = opt.explanation;
          label.dataset.correct = (opt.id === q.correct);
          label.classList.add('option-label');
          optDiv.appendChild(label);
        });

        qDiv.appendChild(optDiv);
        catDiv.appendChild(qDiv);
      });

      const submitBottom = createSubmitControls(name);
      catDiv.appendChild(submitBottom);

      document.getElementById('quizContainer').appendChild(catDiv);
    }

    function createSubmitControls(category) {
      const wrapper = document.createElement('div');
      const submitBtn = document.createElement('button');
      submitBtn.className = 'submit-btn';
      submitBtn.textContent = 'Submit Category';
      submitBtn.onclick = () => checkCategory(category);

      const resetBtn = document.createElement('button');
      resetBtn.className = 'reset-btn';
      resetBtn.textContent = 'Reset Category';
      resetBtn.onclick = () => resetCategory(category);

      wrapper.appendChild(submitBtn);
      wrapper.appendChild(resetBtn);
      return wrapper;
    }

    function checkCategory(category) {
      const catEl = document.getElementById(`cat-${category}`);
      const questions = catEl.querySelectorAll('.question');
      let allCorrect = true;

      questions.forEach((qDiv, i) => {
        const selected = qDiv.querySelector('input[type=radio]:checked');
        if (!selected) {
          allCorrect = false;
          return;
        }

        const correct = selected.parentElement.dataset.correct === 'true';
        qDiv.querySelectorAll('label').forEach(label => label.classList.remove('correct', 'incorrect'));

        selected.parentElement.classList.add(correct ? 'correct' : 'incorrect');

        let expl = qDiv.querySelector('.explanation');
        if (expl) expl.remove();
        const explDiv = document.createElement('div');
        explDiv.className = 'explanation';
        explDiv.style.backgroundColor = correct ? '#d4edda' : '#f8d7da';
        explDiv.textContent = selected.parentElement.dataset.explanation;
        qDiv.appendChild(explDiv);

        if (!correct) allCorrect = false;
      });

      if (allCorrect) {
        catEl.classList.add('completed');
        completedCategories[category] = true;
      }
    }

    function resetCategory(category) {
      const catEl = document.getElementById(`cat-${category}`);
      catEl.remove();
      const questions = shuffle(questionsByCategory[category]).slice(0, 10);
      const color = colors[Object.keys(questionsByCategory).indexOf(category) % colors.length];
      renderCategory(category, questions, color);
    }

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }
  </script>
</body>
</html>
