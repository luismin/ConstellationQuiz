<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pega Constellation Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h1 {
      text-align: center;
    }
    .category {
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    .question {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      margin-bottom: 20px;
      padding: 15px;
    }
    .question p {
      margin: 0 0 10px;
    }
    .option {
      margin: 5px 0;
    }
    .correct {
      background-color: #d4edda;
    }
    .incorrect {
      background-color: #f8d7da;
    }
    .explanation {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
    }
    .submit-category, .reset-category {
      margin: 10px 0;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    .category-header {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .nav {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .nav button {
      margin: 5px;
      padding: 10px;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
    }
    .nav button.done {
      background-color: gray !important;
      cursor: default;
    }
  </style>
</head>
<body>
  <h1>Pega Constellation Quiz</h1>
  <div class="nav" id="categoryNav"></div>
  <div id="quizContainer"></div>
  <script>
    let quizData;
    const categoryColors = ["#5bc0de", "#5cb85c", "#f0ad4e", "#d9534f", "#0275d8", "#6610f2"];
    const usedQuestions = {};

    async function loadXML() {
      const response = await fetch("questions.xml");
      const xml = await response.text();
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xml, "application/xml");
      quizData = xmlDoc;
      renderCategories();
    }

    function renderCategories() {
      const categories = quizData.getElementsByTagName("category");
      const nav = document.getElementById("categoryNav");
      const container = document.getElementById("quizContainer");
      nav.innerHTML = "";
      container.innerHTML = "";

      Array.from(categories).forEach((cat, index) => {
        const catName = cat.getAttribute("name").replace("App Studio & Declarative Development", "Low Code Development");
        const color = categoryColors[index % categoryColors.length];

        const navBtn = document.createElement("button");
        navBtn.textContent = catName;
        navBtn.style.backgroundColor = color;
        navBtn.onclick = () => {
          document.getElementById(`category-${index}`).scrollIntoView({ behavior: "smooth" });
        };
        navBtn.id = `nav-${index}`;
        nav.appendChild(navBtn);

        const section = document.createElement("div");
        section.className = "category";
        section.id = `category-${index}`;
        section.style.backgroundColor = color + "20";

        const header = document.createElement("div");
        header.className = "category-header";
        header.textContent = catName;
        section.appendChild(header);

        const questions = Array.from(cat.getElementsByTagName("question"));
        const selected = shuffleArray(questions).slice(0, 10);
        usedQuestions[index] = selected;

        selected.forEach((q, qi) => {
          const qDiv = document.createElement("div");
          qDiv.className = "question";
          qDiv.dataset.index = qi;
          const qText = q.getElementsByTagName("text")[0].textContent;
          const qId = q.getAttribute("id");
          const correct = q.getElementsByTagName("correct")[0].textContent;

          qDiv.innerHTML += `<p>${qText}</p>`;

          Array.from(q.getElementsByTagName("option")).forEach((opt, i) => {
            const optId = opt.getAttribute("id");
            const optText = opt.childNodes[0].textContent;
            const explanation = opt.getElementsByTagName("explanation")[0].textContent;
            qDiv.innerHTML += `
              <div class="option">
                <label>
                  <input type="radio" name="q${index}-${qi}" value="${optId}" data-correct="${optId === correct}" data-explanation="${explanation}">
                  ${optText}
                </label>
                <div class="explanation" style="display:none;"></div>
              </div>`;
          });
          section.appendChild(qDiv);
        });

        const submitBtnTop = document.createElement("button");
        submitBtnTop.textContent = "Submit Category";
        submitBtnTop.className = "submit-category";
        submitBtnTop.onclick = () => checkCategory(index);
        section.insertBefore(submitBtnTop, section.children[1]);

        const submitBtnBottom = submitBtnTop.cloneNode(true);
        section.appendChild(submitBtnBottom);

        const resetBtn = document.createElement("button");
        resetBtn.textContent = "Reset Category";
        resetBtn.className = "reset-category";
        resetBtn.onclick = () => renderCategories();
        section.appendChild(resetBtn);

        container.appendChild(section);
      });
    }

    function checkCategory(catIndex) {
      const section = document.getElementById(`category-${catIndex}`);
      const questions = usedQuestions[catIndex];
      let allCorrect = true;

      questions.forEach((q, qi) => {
        const qDiv = section.querySelector(`.question[data-index='${qi}']`);
        const correct = q.getElementsByTagName("correct")[0].textContent;
        const selected = qDiv.querySelector("input[type='radio']:checked");
        if (!selected) return;

        const options = qDiv.querySelectorAll(".option");
        options.forEach(opt => {
          const input = opt.querySelector("input");
          const exp = opt.querySelector(".explanation");
          if (input.checked) {
            if (input.getAttribute("data-correct") === "true") {
              opt.classList.add("correct");
              exp.style.display = "block";
              exp.style.backgroundColor = "#d4edda";
              exp.textContent = input.getAttribute("data-explanation");
            } else {
              opt.classList.add("incorrect");
              exp.style.display = "block";
              exp.style.backgroundColor = "#f8d7da";
              exp.textContent = input.getAttribute("data-explanation");
              allCorrect = false;
            }
          }
        });
      });

      if (allCorrect) {
        document.getElementById(`nav-${catIndex}`).classList.add("done");
      }
    }

    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    loadXML();
  </script>
</body>
</html>
