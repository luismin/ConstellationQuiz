<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pega Constellation Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0 20px;
      color: #333;
    }
    h2 {
      margin-top: 40px;
      padding: 10px;
      color: white;
      border-radius: 5px;
    }
    .question {
      margin: 20px 0;
      padding: 10px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .option {
      display: block;
      margin: 8px 0;
    }
    .explanation {
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
    }
    .correct {
      background: #d4edda;
      border: 1px solid #c3e6cb;
    }
    .incorrect {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
    }
    .category-buttons {
      display: flex;
      justify-content: space-between;
      margin: 10px 0 20px;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .submit-btn {
      background-color: #007bff;
      color: white;
    }
    .reset-btn {
      background-color: #dc3545;
      color: white;
    }
    .category-container {
      margin-bottom: 60px;
      padding-bottom: 20px;
      border-bottom: 2px solid #ccc;
    }
    .completed h2 {
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <h1>Pega Constellation Quiz</h1>
  <div id="quiz-container"></div>

  <script>
    const categoryColors = [
      "#4CAF50",
      "#2196F3",
      "#FF9800",
      "#9C27B0",
      "#009688",
      "#E91E63"
    ];

    async function loadXML() {
      const response = await fetch("questions.xml");
      const text = await response.text();
      const parser = new DOMParser();
      const xml = parser.parseFromString(text, "application/xml");
      return xml;
    }

    function getRandomElements(arr, count) {
      const shuffled = arr.sort(() => 0.5 - Math.random());
      return shuffled.slice(0, count);
    }

    function renderQuiz(xml) {
      const quizContainer = document.getElementById("quiz-container");
      quizContainer.innerHTML = "";
      const categories = Array.from(xml.getElementsByTagName("category"));

      categories.forEach((catElem, index) => {
        const categoryName = catElem.getAttribute("name").replace("App Studio & Declarative Development", "Low Code Development");
        const questions = Array.from(catElem.getElementsByTagName("question"));
        const selectedQuestions = getRandomElements(questions, 10);

        const container = document.createElement("div");
        container.className = "category-container";
        container.id = `category-${index}`;
        container.dataset.completed = "false";

        const header = document.createElement("h2");
        header.textContent = categoryName;
        header.style.backgroundColor = categoryColors[index % categoryColors.length];
        container.appendChild(header);

        const btnContainerTop = document.createElement("div");
        btnContainerTop.className = "category-buttons";

        const submitBtnTop = document.createElement("button");
        submitBtnTop.textContent = "Submit Category";
        submitBtnTop.className = "submit-btn";
        submitBtnTop.onclick = () => submitCategory(container, selectedQuestions);

        const resetBtnTop = document.createElement("button");
        resetBtnTop.textContent = "Reset Category";
        resetBtnTop.className = "reset-btn";
        resetBtnTop.onclick = () => renderQuiz(xml);

        btnContainerTop.appendChild(submitBtnTop);
        btnContainerTop.appendChild(resetBtnTop);
        container.appendChild(btnContainerTop);

        selectedQuestions.forEach((qElem, qIndex) => {
          const qText = qElem.getElementsByTagName("text")[0].textContent;
          const correct = qElem.getElementsByTagName("correct")[0].textContent.trim();
          const options = Array.from(qElem.getElementsByTagName("option"));

          const qDiv = document.createElement("div");
          qDiv.className = "question";
          qDiv.dataset.correct = correct;

          const qP = document.createElement("p");
          qP.textContent = `${qIndex + 1}. ${qText}`;
          qDiv.appendChild(qP);

          options.forEach((opt) => {
            const optId = opt.getAttribute("id");
            const label = document.createElement("label");
            label.className = "option";

            const radio = document.createElement("input");
            radio.type = "radio";
            radio.name = `question-${index}-${qIndex}`;
            radio.value = optId;
            label.appendChild(radio);
            label.appendChild(document.createTextNode(" " + opt.textContent.replace(/\n.*$/, "")));

            const explanation = opt.getElementsByTagName("explanation")[0];
            if (explanation) {
              const expDiv = document.createElement("div");
              expDiv.className = "explanation";
              expDiv.textContent = explanation.textContent;
              expDiv.style.display = "none";
              label.appendChild(expDiv);
            }
            qDiv.appendChild(label);
          });

          container.appendChild(qDiv);
        });

        const btnContainerBottom = btnContainerTop.cloneNode(true);
        container.appendChild(btnContainerBottom);
        quizContainer.appendChild(container);
      });
    }

    function submitCategory(container, questions) {
      const questionDivs = container.querySelectorAll(".question");
      let allCorrect = true;

      questionDivs.forEach((qDiv) => {
        const selected = qDiv.querySelector("input[type=radio]:checked");
        if (!selected) return;
        const isCorrect = selected.value.trim() === qDiv.dataset.correct.trim();

        const options = qDiv.querySelectorAll(".option");
        options.forEach((opt) => {
          const radio = opt.querySelector("input[type=radio]");
          const explanation = opt.querySelector(".explanation");
          if (!explanation) return;

          if (radio.checked) {
            if (radio.value.trim() === qDiv.dataset.correct.trim()) {
              explanation.className = "explanation correct";
            } else {
              explanation.className = "explanation incorrect";
              allCorrect = false;
            }
            explanation.style.display = "block";
          } else {
            explanation.style.display = "none";
          }
        });
      });

      if (allCorrect) {
        container.classList.add("completed");
        container.querySelectorAll("button").forEach(btn => btn.disabled = true);
      }
    }

    loadXML().then(renderQuiz);
  </script>
</body>
</html>
